rule MacOS_RustDoor_Malware {
    meta:
        description = "Detects Rust-based backdoor malware targeting macOS systems"
        author = "Dan Birdsall"
        date = "2024-02-18"
        reference = "https://www.bitdefender.co.uk/blog/labs/new-macos-backdoor-written-in-rust-shows-possible-link-with-windows-ransomware-group/"
    strings:
        $path_notesdb = "Library/Group Containers/group.com.apple.notes/NoteStore.sqlite" ascii

        $exfil_ext = /\.(txt|rtf|doc|xls|xlsx|png|pdf|pem|asc|ppk|rdp|zip|sql|ovpn|kdbx|conf|key|json)$/ ascii

        $exfil_zip = "_home.zip" ascii

        // Persistence mechanism indicators
        $persistence_cron = "lock_in_cron" ascii
        $persistence_launch = "lock_in_launch" ascii
        $persistence_dock = "lock_in_dock" ascii
        $persistence_rc = "lock_in_rc" ascii

        // Potential Rust command/function call indicators for suspicious activity
        $rust_command_1 = "exec::command" ascii
        $rust_command_2 = "std::process::Command" ascii
        

    condition:
        1 of ($persistence*) and (2 of ($exfil_ext, $path_notesdb, $exfil_zip) or 1 of ($rust_command_*))
}
