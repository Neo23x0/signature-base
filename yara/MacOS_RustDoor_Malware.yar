rule MacOS_RustDoor_Malware {
    meta:
        description = "Detects Rust-based backdoor malware targeting macOS systems"
        author = "Dan Birdsall"
        date = "2024-02-18"
        reference = "https://www.bitdefender.co.uk/blog/labs/new-macos-backdoor-written-in-rust-shows-possible-link-with-windows-ransomware-group/"
    strings:
        $rust_commands1 = "ps"
        $rust_commands2 = "shell"
        $rust_commands3 = "cd"
        $rust_commands4 = "mkdir"
        $rust_commands5 = "rm"
        $rust_commands6 = "rmdir"
        $rust_commands7 = "sleep"
        $rust_commands8 = "upload"
        $rust_commands9 = "botkill"
        $rust_commands10 = "dialog"
        $rust_commands11 = "taskkill"
        $rust_commands12 = "download"

        $mac_info1 = "machdep.cpu.vendor"
        $mac_info2 = "machdep.cpu.brand_string"
        $mac_info3 = "kern.osproductversion"
        $mac_info4 = "hw.cpufrequency"

        $c2_endpoint1 = "/gateway/register"
        $c2_endpoint2 = "/gateway/report"
        $c2_endpoint3 = "/gateway/task"
        $c2_endpoint4 = "/tasks/upload_file"

        $persistence_method1 = "lock_in_cron"
        $persistence_method2 = "lock_in_launch"
        $persistence_method3 = "lock_in_dock"
        $persistence_method4 = "lock_in_rc"
    condition:
        2 of (
            $rust_commands* or
            $mac_info* or
            $c2_endpoint* or
            $persistence_method*
        )
}
